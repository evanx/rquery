{"version":3,"sources":["../lib/Styles.js"],"names":[],"mappings":"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","file":"Styles.js","sourcesContent":["\nconst logger = Loggers.create(module.filename, 'info');\n\nconst IntegerKeys = ['lineHeight'];\nconst CssKeys = Strings.splitSpace(`\n   color background\n   width height\n   cursor\n   display position float clear\n   textDecoration\n   `\n);\nconst CssKeyPrefixes = Strings.splitSpace(`\n   text\n   margin padding border\n   font background min\n   `\n);\n\nconst CssKeyRegex = new RegExp(createCssKeyRegexString());\n\nfunction test() {\n   logger.debug('CssKeys', CssKeys.join('|'));\n   logger.debug('CssKeyRegex', createCssKeyRegexString());\n}\n\nif (process.env.NODE_ENV !== 'production') {\n   test();\n}\n\nfunction createCssKeyRegexString() {\n   const prefixes = CssKeys.concat(CssKeyPrefixes);\n   return ['^(', prefixes.join('|'), ')'].join('');\n}\n\n// exports\n\nexport function meta(meta, style) {\n   return {meta, style};\n}\n\nexport function renderStyles(object) {\n   const styles = renderKeys(object, 'root');\n   logger.debug('styles', styles);\n   return styles;\n}\n\nexport function renderStyleSheet(object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nconst userAgentCache = new Map();\n\nfunction getUserAgentType(key, ua) {\n   if (ua.match(/Mobile/)) {\n      return 'm';\n   } else {\n      return 'o';\n   }\n}\n\nexport function getCachedUserAgentStyleSheet(options) {\n   const {styles, key, ua} = options;\n   assert.equal(typeof styles[key], 'object', 'css stylesheet object: ' + key);\n   options.uaType = getUserAgentType(key, ua);\n   options.uaKey = [options.uaType, key].join(':');\n   const entry = userAgentCache.get(options.uaKey);\n   if (entry) {\n      if (entry.expire && entry.expire < new Date().getTime()) {\n      } else if (entry.value) {\n         return entry.value;\n      }\n   }\n   return setUserAgentStyleSheet(options);\n}\n\nexport function setUserAgentStyleSheet({styles, key, uaKey, uaType}) {\n   const entry = {expire: 0};\n   entry.value = getUserAgentStyleSheet(styles[key]);\n   if (uaType === 'o') {\n      const mediaKey = '_768';\n      const mediaStyles = styles[mediaKey];\n      if (mediaStyles) {\n         const styleSheet = mediaStyles[key];\n         if (!styleSheet) {\n            logger.debug('stylesheet empty', key, mediaKey);\n         } else {\n            entry.value += getUserAgentStyleSheet(styleSheet);\n         }\n      }\n   }\n   userAgentCache.set(uaKey, entry);\n   return entry.value;\n}\n\nexport function getUserAgentStyleSheet(object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nexport function renderUserAgentStylesheet(userAgent, object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nexport function renderKeys(object, key) {\n   if (Object.keys(object).filter(key => isCssKey(key)).length) {\n      return lodash.compact(Object.keys(object).map(key => {\n         return {key: renderKey(key), value: renderValue(object[key], key)};\n      }).map(entry => {\n         if (entry.key && lodash.isString(entry.value)) {\n            return `${entry.key}:${entry.value}`\n         } else {\n            logger.warn('renderKeys', entry.key, typeof entry.value);\n         }\n      })).join(';');\n   } else {\n      return Object.keys(object).reduce((result, key) => {\n         result[key] = renderValue(object[key], key);\n         return result;\n      }, {});\n   }\n}\n\nexport function renderValue(value, key) {\n   if (!Values.isDefined(value)) {\n      logger.debug('renderValue empty', key);\n      return '';\n   } else if (Values.isInteger(value)) {\n      if (IntegerKeys.includes(key)) {\n         return value.toString();\n      } else {\n         return `${value}px`;\n      }\n   } else if (lodash.isNumber(value)) {\n      return value.toString();\n   } else if (lodash.isString(value)) {\n      return value;\n   } else if (lodash.isArray(value)) {\n      return value.map(v => renderValue(v, key)).join(' ');\n   } else if (lodash.isObject(value)) {\n      return renderKeys(value);\n   } else {\n      throw {message: 'Unsupported type: ' + typeof value, key};\n   }\n}\n\nfunction renderKey(key) {\n   return lodash.kebabCase(key);\n}\n\nfunction isCssKey(key) {\n   return IntegerKeys.includes(key)\n   || key.match(CssKeyRegex);\n}\n"]}
{"version":3,"sources":["../lib/Styles.js"],"names":[],"mappings":"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","file":"Styles.js","sourcesContent":["\nconst logger = Loggers.create(module.filename, 'info');\n\nconst IntegerKeys = ['lineHeight'];\nconst CssKeys = Strings.splitSpace(`\n   color background\n   width height\n   cursor\n   display position float clear\n   textDecoration\n   `\n);\nconst CssKeyPrefixes = Strings.splitSpace(`\n   text\n   margin padding border\n   font background min\n   `\n);\n\nconst CssKeyRegex = new RegExp(createCssKeyRegexString());\n\nfunction test() {\n   logger.debug('CssKeys', CssKeys.join('|'));\n   logger.debug('CssKeyRegex', createCssKeyRegexString());\n}\n\nif (process.env.NODE_ENV !== 'production') {\n   test();\n}\n\nfunction createCssKeyRegexString() {\n   const prefixes = CssKeys.concat(CssKeyPrefixes);\n   return ['^(', prefixes.join('|'), ')'].join('');\n}\n\n// exports\n\nexport function meta(meta, style) {\n   return {meta, style};\n}\n\nexport function renderStyles(object) {\n   const styles = renderKeys(object, []);\n   logger.debug('styles', styles);\n   return styles;\n}\n\nexport function renderStyleSheet(object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nconst userAgentCache = new Map();\n\nfunction getUserAgentType(key, ua) {\n   if (ua.match(/Mobile/)) {\n      return 'm';\n   } else {\n      return 'o';\n   }\n}\n\nexport function getCachedUserAgentStyleSheet(options) {\n   const {styles, key, ua} = options;\n   assert.equal(typeof styles[key], 'object', 'css stylesheet object: ' + key);\n   options.uaType = getUserAgentType(key, ua);\n   options.uaKey = [options.uaType, key].join(':');\n   const entry = userAgentCache.get(options.uaKey);\n   if (entry) {\n      if (entry.expire && entry.expire < new Date().getTime()) {\n      } else if (entry.value) {\n         return entry.value;\n      }\n   }\n   return setUserAgentStyleSheet(options);\n}\n\nexport function setUserAgentStyleSheet({styles, key, uaKey, uaType}) {\n   const entry = {expire: 0};\n   entry.value = getUserAgentStyleSheet(styles[key]);\n   if (uaType === 'o') {\n      const mediaKey = '_768';\n      const mediaStyles = styles[mediaKey];\n      if (mediaStyles) {\n         const styleSheet = mediaStyles[key];\n         if (!styleSheet) {\n            logger.debug('stylesheet empty', key, mediaKey);\n         } else {\n            entry.value += getUserAgentStyleSheet(styleSheet);\n         }\n      }\n   }\n   userAgentCache.set(uaKey, entry);\n   return entry.value;\n}\n\nexport function getUserAgentStyleSheet(object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nexport function renderUserAgentStylesheet(userAgent, object) {\n   return Object.keys(object)\n   .map(key => Objects.kv(object, key))\n   .filter(kv => lodash.isString(kv.value))\n   .map(kv => [kv.key, '{',  kv.value, '}'].join(' '))\n   .join('\\n');\n}\n\nexport function renderKeys(object, parentKeys) {\n   if (Object.keys(object).filter(key => isCssKey(key)).length) {\n      return lodash.compact(Object.keys(object).map(key => {\n         return {key: renderKey(key), value: renderValue(object[key], key, parentKeys)};\n      }).map(entry => {\n         if (entry.key && lodash.isString(entry.value)) {\n            return `${entry.key}:${entry.value}`\n         } else {\n            logger.warn('renderKeys', entry.key, typeof entry.value);\n         }\n      })).join(';') + ';-rh-key:' + lodash.compact(parentKeys).join('-');\n   } else {\n      return Object.keys(object).reduce((result, key) => {\n         result[key] = renderValue(object[key], key, parentKeys);\n         return result;\n      }, {});\n   }\n}\n\nexport function renderValue(value, key, parentKeys) {\n   if (!Values.isDefined(value)) {\n      logger.debug('renderValue empty', key);\n      return '';\n   } else if (Values.isInteger(value)) {\n      if (IntegerKeys.includes(key)) {\n         return value.toString();\n      } else {\n         return `${value}px`;\n      }\n   } else if (lodash.isNumber(value)) {\n      return value.toString();\n   } else if (lodash.isString(value)) {\n      return value;\n   } else if (lodash.isArray(value)) {\n      return value.map(v => renderValue(v, key, parentKeys)).join(' ');\n   } else if (lodash.isObject(value)) {\n      return renderKeys(value, parentKeys.concat([key]));\n   } else {\n      throw {message: 'Unsupported type: ' + typeof value, key};\n   }\n}\n\nfunction renderKey(key) {\n   return lodash.kebabCase(key);\n}\n\nfunction isCssKey(key) {\n   return IntegerKeys.includes(key)\n   || key.match(CssKeyRegex);\n}\n"]}
{"version":3,"sources":["../../rquery/handlers/Result.js"],"names":[],"mappings":"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","file":"Result.js","sourcesContent":["\n\nimport styles from '../html/styles';\nimport * as KeyspaceHelp from '../html/KeyspaceHelp';\nimport {default as renderPage} from '../html/Page';\n\nconst logger = Loggers.create(module.filename);\n\nexport async function sendResult(command, req, res, reqx, result) {\n   const {rquery} = global;\n   logger.info(Loggers.keys(rquery.config, 'config'));\n   assert(rquery, 'rquery');\n   const userAgent = req.get('User-Agent');\n   const uaMatch = userAgent.match(/\\s([A-Z][a-z]*\\/[\\.0-9]+)\\s/);\n   rquery.logger.debug('sendResult ua', !uaMatch? userAgent: uaMatch[1]);\n   command = command || {};\n   const mobile = rquery.isMobile(req);\n   rquery.logger.debug('sendResult mobile', mobile, command.key);\n   if (rquery.isDevelopment(req)) {\n      rquery.logger.debug('sendResult command', command.key, req.params, lodash.isArray(result));\n   } else {\n   }\n   if (command.sendResult) {\n      if (lodash.isFunction(command.sendResult)) {\n         const otherResult = await command.sendResult(req, res, reqx, result);\n         if (otherResult === undefined) {\n            return;\n         } else {\n            result = otherResult;\n         }\n      } else {\n         throw new ValidationError('command.sendResult type: ' + typeof command.sendResult);\n      }\n   }\n   let resultString = '';\n   if (!Values.isDefined(result)) {\n      rquery.logger.error('sendResult none');\n   } else if (Values.isDefined(req.query.json) || (command.format === 'json' && !mobile)) {\n      res.json(result);\n      return;\n   } else if (Values.isDefined(req.query.quiet)) {\n   } else if (rquery.config.defaultFormat === 'cli' || Values.isDefined(req.query.line)\n   || rquery.isCliDomain(req) || command.format === 'cli') {\n      res.set('Content-Type', 'text/plain');\n      if (lodash.isArray(result)) {\n         if (mobile) {\n         } else {\n            resultString = result.join('\\n');\n         }\n      } else if (lodash.isObject(result)) {\n         if (command.resultObjectType === 'KeyedArrays') {\n            resultString = lodash.flatten([\n               'message: ' + result.message\n            ].concat(Object.keys(result)\n            .filter(key => !['message'].includes(key))\n            .map(key => {\n               let value = result[key];\n               if (lodash.isArray(value)) {\n                  const array = value;\n                  return ['', key + ':'].concat(array.map(element => element.toString()));\n               } else if (typeof value === 'string') {\n                  if (key === 'message') {\n                     return value;\n                  } else {\n                     return key + ': ' + value;\n                  }\n               } else {\n                  return ['', key + ': type ' + typeof value];\n               }\n            }))).join('\\n');\n         } else {\n            resultString = Object.keys(result).map(key => {\n               let value = result[key];\n               if (parseInt(value) === value) {\n                  value = parseInt(value);\n               } else {\n                  value = `'${value}'`;\n               }\n               return [key, value].join('=');\n            }).join('\\n');\n         }\n      } else if (result === null) {\n      } else {\n         resultString = result.toString();\n      }\n   } else if (rquery.config.defaultFormat === 'plain' || Values.isDefined(req.query.plain)\n   || command.format === 'plain') {\n      res.set('Content-Type', 'text/plain');\n      if (lodash.isArray(result)) {\n         resultString = result.join('\\n');\n      } else {\n         resultString = result.toString();\n      }\n   } else if (rquery.config.defaultFormat === 'json' && !mobile) {\n      res.json(result);\n      return;\n   } else if (rquery.config.defaultFormat === 'html' || Values.isDefined(req.query.html)\n   || command.format === 'html' || rquery.isHtmlDomain(req) || mobile) {\n      return sendHtmlResult(command, req, res, reqx, result);\n   } else {\n      rquery.sendError(req, res, {message: `Invalid default format: ${rquery.config.defaultFormat}`});\n      return;\n   }\n   res.send(resultString + '\\n');\n}\n\nfunction sendHtmlResult(command, req, res, reqx, result) {\n   const {rquery} = global;\n   let title = rquery.config.serviceLabel;\n   let heading, icon;\n   if (reqx.account && reqx.keyspace) {\n      const keyspaceLabel = KeyspaceHelp.obscureKeyspaceLabel(reqx);\n      title = `${reqx.account}/${keyspaceLabel}`;\n      heading = [Hc.b(reqx.account), Hs.tt(styles.header.keyspace, keyspaceLabel)].join('');\n      icon = 'database';\n   }\n   let resultString = '';\n   let resultArray = [];\n   if (!Values.isDefined(result)) {\n   } else if (result === null) {\n   } else if (Values.isInteger(result)) {\n      resultString = result.toString();\n   } else if (lodash.isString(result)) {\n      resultString = result;\n   } else if (lodash.isArray(result)) {\n      if (lodash.isFunction(command.renderHtmlEach)) {\n         resultArray = result.map(element => command.renderHtmlEach(element));\n      } else {\n         resultArray = lodash.flatten(result.map(element => {\n            if (lodash.isObject(element)) {\n               if (element.url && element.content) {\n                  if (rquery.isBrowser(req)) {\n                     return He.a({href: element.url}, element.content);\n                  } else {\n                     return [element.content, element.url];\n                  }\n               }\n            }\n            return element;\n         }));\n      }\n   } else if (lodash.isObject(result)) {\n      resultArray = Object.keys(result).map(key => `<b>${key}</b> ${result[key]}`);\n   } else if (result) {\n      resultString = result.toString();\n   }\n   res.set('Content-Type', 'text/html');\n   const content = [];\n   rquery.logger.debug('sendResult reqx', reqx, command, resultString, resultArray.length);\n   if (command.key) {\n      content.push(Hso.div(styles.result.commandKey, command.key.replace(/-/g, ' ')));\n   }\n   if (reqx.key) {\n      content.push(Hso.div(styles.result.reqKey, reqx.key));\n   }\n   if (command.params) {\n      content.push(Hso.pre(styles.result.commandParams, command.params\n         .filter(key => key !== 'key')\n         .map(key => `<b>${key}</b> ${req.params[key]}`)\n         .join('\\n'))\n      );\n      rquery.logger.info('params', lodash.last(content));\n   }\n   let statusCode = 200;\n   let emptyMessage;\n   if (resultArray.length) {\n      if (resultString) {\n         rquery.logger.error('sendResult resultString', command, req.path);\n      }\n   } else if (!resultString) {\n      //statusCode = 404;\n      resultString = '<i>&lt;empty&gt;</i>';\n   }\n   if (resultString) {\n      resultArray.push(resultString);\n   }\n   content.push(Hs.pre(styles.result.resultArray, lodash.compact(resultArray).join('\\n')));\n   let hints = [];\n   if (command && reqx.account && reqx.keyspace) {\n      if (command.relatedCommands) {\n         try {\n            hints = getRelatedCommandHints(req, reqx, command.relatedCommands);\n         } catch (err) {\n            rquery.logger.error('related', err, err.stack);\n         }\n      }\n      hints.push({\n         uri: ['help'],\n         description: 'view sample keyspace commands'\n      });\n      const otherHints = hints.filter(hint => !hint.uri && hint.commandKey);\n      hints = hints\n      .filter(hint => hint.uri);\n      const renderedPathHints = hints\n      .map(hint => {\n         const path = HtmlElements.renderPath(['ak', reqx.account, reqx.keyspace, ...hint.uri].join('/'));\n         hint = Object.assign({path}, hint);\n         return hint;\n      })\n      .map(hint => {\n         const uriLabel = [Hc.b(hint.uri[0]), ...hint.uri.slice(1)].join('/');\n         rquery.logger.debug('hint', uriLabel, hint);\n         return He.div({\n            style: styles.result.hint.container,\n            onClick: HtmlElements.onClick(hint.path)\n         }, [\n            Hso.div(styles.result.hint.message, hint.message),\n            Hso.div(styles.result.hint.link, `Try: ` + Hs.tt(styles.result.hint.uri, uriLabel)),\n            Hso.div(styles.result.hint.description, lodash.capitalize(hint.description))\n         ]);\n      });\n      rquery.logger.debug('renderedPathHints', renderedPathHints);\n      content.push(renderedPathHints);\n      const renderedOtherHints = otherHints.map(hint => He.div({\n         style: styles.result.hint.container\n      }, [\n         Hso.div(styles.result.hint.message, hint.message),\n         Hso.div(styles.result.hint.link, `Try: ` + Hs.tt(styles.result.hint.uri, Hc.b(hint.commandKey))),\n         Hso.div(styles.result.hint.description, hint.description)\n      ]));\n      content.push(renderedOtherHints);\n   }\n   res.status(statusCode).send(renderPage({\n      config: rquery.config, req, reqx, title, heading, icon, content\n   }));\n}\n\nfunction getRelatedCommandHints(req, reqx, relatedCommands) {\n   const {rquery} = global;\n   return lodash.compact(relatedCommands\n      .map(commandKey => rquery.commandMap.get(commandKey))\n      .filter(command => command && command.key && command.params)\n      .filter(command => !rquery.isSecureDomain(req)\n      || !command.access || lodash.includes(['get', 'debug']\n      , command.access))\n      .map(command => {\n         let uri = [command.key];\n         const params = command.params\n         .map(key => {\n            let value = req.params[key] || [];\n            if (command && command.exampleKeyParams && command.exampleKeyParams.hasOwnProperty(key)) {\n               value = command.exampleKeyParams[key]\n            }\n            rquery.logger.info('related', key, value);\n            return value;\n         });\n         rquery.logger.info('related params', params);\n         if (params.length !== command.params.length) {\n            rquery.logger.warn('params length', command);\n            return null;\n         } else {\n            uri = uri.concat(...params);\n         }\n         return {\n            uri,\n            description: command.description\n         };\n      })\n   );\n}\n"]}
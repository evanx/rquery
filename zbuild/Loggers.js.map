{"version":3,"sources":["../lib/Loggers.js"],"names":[],"mappings":"g0BAgFgB,M,CAAA,M,kJA/EhB,IAAM,OAAS,CACZ,WAAY,EADA,CAAf,C,IAIM,M,YAEH,gBAAY,OAAZ,CAAqB,8BAClB,OAAO,MAAP,CAAc,IAAd,CAAoB,OAApB,EACA,KAAK,MAAL,CAAc,OAAO,YAAP,CAAoB,CAAC,KAAM,KAAK,IAAZ,CAAkB,MAAO,KAAK,KAA9B,CAApB,CAAd,CACA,KAAK,MAAL,CAAY,IAAZ,CAAiB,QAAjB,CAA2B,OAAO,WAAlC,CAA+C,OAA/C,EACF,C,0DAEQ,CACR,C,qCAEc,+BAAN,IAAM,sCAAN,IAAM,wBACZ,GAAI,KAAK,KAAL,GAAe,OAAnB,CAA4B,aACzB,cAAK,MAAL,EAAY,IAAZ,gBAAiB,OAAjB,SAA6B,IAA7B,GACF,CACD,OAAO,KAAK,CAAL,CAAP,CACF,C,qCAEc,cACZ,eAAK,MAAL,EAAY,KAAZ,2BACA,GAAI,UAAK,MAAL,CAAc,CAAlB,CAAqB,CAClB,yBAAY,UAAK,MAAL,CAAc,CAA1B,uBAAY,UAAK,MAAL,CAAc,CAA1B,IACF,CACH,C,mCAEa,cACX,eAAK,MAAL,EAAY,IAAZ,2BACF,C,mCAEa,cACX,eAAK,MAAL,EAAY,IAAZ,2BACF,C,4HAIQ,G,CAGG,U,CAEG,O,CACA,G,gIAPZ,eAAK,MAAL,EAAY,KAAZ,uBACM,G,CAAM,IAAI,IAAJ,GAAW,OAAX,E,MACR,CAAC,KAAK,SAAN,EAAmB,IAAM,KAAK,SAAX,CAAuB,OAAO,UAAP,CAAkB,I,2BAC7D,KAAK,SAAL,CAAiB,GAAjB,CACM,U,CAAa,OAAO,U,KACtB,U,0BACK,O,CAAU,KAAK,SAAL,CAAe,KAAK,GAAL,kBAAf,C,CACV,G,CAAM,CAAC,UAAD,CAAa,YAAb,CAA2B,OAA3B,CAAoC,GAApC,EAAyC,IAAzC,CAA8C,GAA9C,C,yCAEH,SAAS,OAAT,CAAiB,CAAC,OAAD,CAAM,OAAQ,MAAd,CAAjB,C,0FAEN,OAAO,IAAP,CAAY,QAAZ,CAAsB,UAAtB,c,6KAMC,gCAAN,IAAM,2CAAN,IAAM,0BACV,OAAO,KAAK,GAAL,CAAS,aAAO,CACpB,GAAI,MAAQ,SAAZ,CAAuB,CACtB,CADD,KACO,GAAI,MAAQ,IAAZ,CAAkB,CACxB,CADM,KACA,GAAI,MAAQ,EAAZ,CAAgB,CACtB,CADM,KACA,GAAI,OAAO,GAAP,GAAe,QAAnB,CAA6B,CACnC,CADM,KACA,GAAI,OAAO,GAAP,GAAe,QAAnB,CAA6B,CACnC,CADM,KACA,GAAI,OAAO,OAAP,CAAe,GAAf,CAAJ,CAAyB,CAC/B,CADM,KACA,GAAI,IAAI,OAAR,CAAiB,CACrB,IAAM,IAAI,OAAV,CACF,CAFM,KAEA,GAAI,IAAI,WAAR,CAAqB,CACzB,GAAI,IAAI,WAAJ,CAAgB,IAApB,CAA0B,CACvB,IAAM,IAAM,IAAI,WAAJ,CAAgB,IAA5B,CACF,CAFD,KAEO,CACJ,IAAM,SAAN,CACF,CACH,CANM,KAMA,CACJ,IAAM,YAAa,GAAb,mCAAa,GAAb,EAAN,CACF,CACD,OAAO,GAAP,CACF,CAnBM,CAAP,CAoBF,C,sBAGG,SAAS,MAAT,CAAgB,QAAhB,CAA0B,KAA1B,CAAiC,CACrC,IAAI,KAAO,QAAX,CACA,IAAM,UAAY,SAAS,KAAT,CAAe,uBAAf,CAAlB,CACA,GAAI,SAAJ,CAAe,CACZ,KAAO,UAAU,CAAV,CAAP,CACF,CACD,MAAQ,OAAS,OAAO,WAAxB,CACA,OAAO,IAAI,MAAJ,CAAW,CAAC,SAAD,CAAO,WAAP,CAAX,CAAP,CACF","file":"Loggers.js","sourcesContent":["\nconst config = {\n   errorLimit: 30\n};\n\nclass Logger {\n\n   constructor(options) {\n      Object.assign(this, options);\n      this.logger = bunyan.createLogger({name: this.name, level: this.level});\n      this.logger.info('create', global.loggerLevel, options);\n   }\n\n   ndebug() {\n   }\n\n   dwarn(...args) {\n      if (this.level === 'debug') {\n         this.logger.warn('DEBUG', ...args);\n      }\n      return args[0];\n   }\n\n   debug(...args) {\n      this.logger.debug(...args);\n      if (args.length > 0) {\n         return args[args.length - 1];\n      }\n   }\n\n   info(...args) {\n      this.logger.info(...args);\n   }\n\n   warn(...args) {\n      this.logger.warn(...args);\n   }\n\n   async error(...args) {\n      this.logger.error(...args);\n      const now = new Date().getTime();\n      if (!this.errorTime || now - this.errorTime > config.errorLimit*1000) {\n         this.errorTime = now;\n         const loggingUrl = global.loggingUrl;\n         if (loggingUrl) {\n            const message = JSON.stringify(this.map(...args));\n            const url = [loggingUrl, 'lpush-trim', message, 100].join('/');\n            try {\n               await Promises.request({url, method: 'head'});\n            } catch (err) {\n               logger.warn('remote', loggingUrl, err);\n            }\n         }\n      }\n   }\n\n   map(...args) {\n      return args.map(arg => {\n         if (arg === undefined) {\n         } else if (arg === null) {\n         } else if (arg === '') {\n         } else if (typeof arg === 'string') {\n         } else if (typeof arg === 'number') {\n         } else if (lodash.isArray(arg)) {\n         } else if (arg.message) {\n            arg = arg.message;\n         } else if (arg.constructor) {\n            if (arg.constructor.name) {\n               arg = '@' + arg.constructor.name;\n            } else {\n               arg = '?object';\n            }\n         } else {\n            arg = '?' + typeof arg;\n         }\n         return arg;\n      });\n   }\n}\n\nexport function create(filename, level) {\n   let name = filename;\n   const nameMatch = filename.match(/([^\\/\\\\]+)\\.[a-z0-9]+/);\n   if (nameMatch) {\n      name = nameMatch[1];\n   }\n   level = level || global.loggerLevel;\n   return new Logger({name, level});\n};\n"]}